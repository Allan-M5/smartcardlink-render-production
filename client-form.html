<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SmartCardLink Client Form</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  body {
    font-family: 'Inter', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 1rem;
    background: none;
    position: relative;
    color: white;
  }
  #bg-video {
    position: fixed;
    right: 0;
    bottom: 0;
    min-width: 100%;
    min-height: 100%;
    z-index: -100;
    filter: brightness(0.4) saturate(1.2);
    object-fit: cover;
  }
  .form-card {
    background-color: #111;
    border-radius: 1rem;
    padding: 2rem;
    width: 100%;
    max-width: 750px;
    border: 1px solid #333;
    box-shadow: 0 0 20px rgba(0,0,0,0.4);
    overflow-y: auto;
  }
  h1.title {
    color: #FFD700;
    text-align: center;
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }
  button {
    transition: background-color 0.3s, color 0.3s;
    font-weight: 600;
    padding: 0.75rem;
    border-radius: 0.375rem;
    cursor: pointer;
    background-color: black;
    color: white;
    border: 1px solid #FFD700;
    width: 100%;
    margin-top: 1rem;
  }
  button:hover {
    background-color: #FFD700;
    color: black;
  }
  .section-header {
    background-color: #1f2937;
    color: #FFD700;
    padding: 0.5rem;
    text-align: center;
    border-radius: 0.375rem;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    font-weight: 600;
  }
  label {
    color: white;
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
    display: block;
  }
  input, textarea {
    width: 100%;
    padding: 0.5rem;
    border-radius: 0.375rem;
    border: 1px solid #ccc;
    resize: vertical;
    box-sizing: border-box;
    background-color: white;
    color: black;
  }
  .grid-2col {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }
  .payment-info, .disclaimer {
    margin-top: 1rem;
    padding: 1rem;
    border: 1px solid #FFD700;
    border-radius: 0.5rem;
    background-color: #1a1a1a;
    text-align: center;
  }
  .payment-info p {
    margin: 0.25rem 0;
    color: #f0f0f0;
    font-size: 0.9rem;
  }
  .disclaimer h3 {
    margin: 0;
    color: #FFD700;
  }
  .disclaimer ul {
    list-style-type: disc;
    padding-left: 20px;
    text-align: left;
    margin-top: 0.5rem;
  }
  .disclaimer li {
    margin-bottom: 0.25rem;
    font-size: 0.9rem;
  }
  @media (max-width: 768px) {
    .grid-2col {
      grid-template-columns: 1fr;
    }
  }
  .form-message {
    text-align: center;
    padding: 1rem;
    margin-top: 1rem;
    border-radius: 0.5rem;
    font-weight: bold;
    display: none;
  }
  .form-message.success { background-color: #d1e7dd; color: #0f5132; display: block; }
  .form-message.error { background-color: #f8d7da; color: #842029; display: block; }
</style>
</head>
<body>
<video autoplay muted loop playsinline id="bg-video">
  <source src="https://res.cloudinary.com/dicvwaud3/video/upload/v1754439276/oyvgam7oizwizgwxaxge.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video>

<div class="form-card">
  <h1 class="title">SmartCardLink Client Form</h1>

  <form id="clientForm" autocomplete="off">
    <!-- all your form fields remain exactly the same -->
    <!-- … (unchanged fields) … -->
    <button type="submit">Submit Form</button>
  </form>

  <div class="form-message" id="formMessage"></div>
</div>

<script>
  // Use dynamic API base (respects environment or fallback to localhost:8080)
  const API_BASE_URL = window.SCL_CONFIG?.API_BASE || "http://localhost:8080";

  const form = document.getElementById("clientForm");
  const formMessage = document.getElementById("formMessage");

  function showMessage(message, type) {
    formMessage.innerHTML = message;
    formMessage.className = `form-message ${type}`;
    formMessage.style.display = 'block';
  }

  async function submitForm() {
    const formData = new FormData(form);
    const payload = Object.fromEntries(formData.entries());

    // Build socialLinks & workingHours properly
    payload.socialLinks = {};
    ["facebook","instagram","twitter","linkedin","tiktok","youtube"].forEach(k=>{
      if(formData.get(k)) payload.socialLinks[k]=formData.get(k).trim();
    });

    payload.workingHours = {};
    ["monFriStart","monFriEnd","satStart","satEnd","sunStart","sunEnd"].forEach(k=>{
      if(formData.get(k)) payload.workingHours[k]=formData.get(k).trim();
    });

    if (!payload.fullName || !payload.phone1 || !payload.email1 || !payload.company) {
      throw new Error("Please fill in all required fields: Full Name, Phone 1, Email 1, and Company.");
    }

    const resp = await fetch(`${API_BASE_URL}/api/clients`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (!resp.ok) {
      const errData = await resp.json().catch(()=>({}));
      throw new Error(errData.message || `Server error: ${resp.status}`);
    }
    return await resp.json();
  }

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const btn = form.querySelector("button[type=submit]");
    btn.disabled = true;
    try {
      showMessage("Submitting form…", "info");
      const data = await submitForm();
      const recordId = data.recordId || data.id || "N/A";
      showMessage(`✔ Success! Record ID: ${recordId}`, "success");
      form.reset();
    } catch (err) {
      showMessage(`❌ ${err.message}`, "error");
      console.error(err);
    } finally {
      btn.disabled = false;
    }
  });
</script>
</body>
</html>
